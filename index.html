<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FlashFlow Vocab</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        :root {
            --primary: #6a8cff;
            --secondary: #9a6aff;
            --success: #4caf50;
            --error: #ff5252;
            --bg: #121212;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg);
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            overflow: hidden;
            touch-action: none; /* Prevents scrolling while swiping */
        }

        .app-container {
            width: 100%;
            max-width: 400px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Input Panel */
        .panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        textarea {
            width: 100%;
            height: 150px;
            background: rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            color: white;
            padding: 12px;
            margin: 15px 0;
            font-family: monospace;
            box-sizing: border-box;
            resize: none;
        }

        /* Card Engine */
        #game {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }

        .card-stack {
            position: relative;
            width: 100%;
            height: 400px;
            perspective: 1000px;
        }

        .card {
            width: 100%;
            height: 100%;
            position: absolute;
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out; /* Smooth follow-through */
            cursor: grab;
        }

        .card.flipping {
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            text-align: center;
            font-size: 28px;
            font-weight: 700;
            box-sizing: border-box;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            background: white;
            color: #1a1a2e;
        }

        .back {
            transform: rotateY(180deg);
            background: #f0f3ff;
            color: var(--secondary);
        }

        .flipped {
            transform: rotateY(180deg) !important;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 15px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
        }

        button:active { transform: scale(0.95); }

        .btn-knew { background: var(--success); color: white; }
        .btn-didnt { background: var(--error); color: white; }
        .btn-start { background: var(--primary); color: white; }

        .hidden { display: none !important; }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            margin-bottom: 20px;
        }
        #progress-bar {
            width: 0%;
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
            transition: width 0.3s;
        }

        .hint {
            text-align: center;
            font-size: 12px;
            opacity: 0.6;
            margin-top: 15px;
        }
    </style>
</head>
<body>

<div class="app-container">

    <div id="setup" class="panel">
        <h2 style="margin-top:0">Study Mode üî•</h2>
        <p style="font-size:14px; opacity:0.8">Paste your words (Word, Meaning)</p>
        <textarea id="input" placeholder="Apple, Manzana&#10;Book, Libro"></textarea>
        <div class="controls">
            <button class="btn-start" onclick="loadVocab()">Start Session</button>
            <button style="background:#444; color:white;" onclick="loadSaved()">Load Last</button>
        </div>
    </div>

    <div id="game" class="hidden">
        <div class="progress-container"><div id="progress-bar"></div></div>
        
        <div class="card-stack" id="stack">
            <div class="card" id="card">
                <div class="face front" id="front">Word</div>
                <div class="face back" id="back">Meaning</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn-didnt" onclick="manualMark(false)">Forgot</button>
            <button class="btn-knew" onclick="manualMark(true)">Got it!</button>
        </div>
        <p class="hint">Tap to flip ‚Ä¢ Swipe Right for "Got it" ‚Ä¢ Swipe Left for "Forgot"</p>
    </div>

    <div id="result" class="panel hidden">
        <h2 id="score-text">Finished!</h2>
        <div id="result-lists" style="max-height: 300px; overflow-y: auto;">
            </div>
        <button class="btn-start" style="width:100%; margin-top:20px" onclick="location.reload()">Try Again</button>
    </div>

</div>

<script>
    let cards = [];
    let index = 0;
    let correct = [];
    let wrong = [];
    
    // Swipe & Animation state
    let startX = 0;
    let currentX = 0;
    let isDragging = false;
    const cardEl = document.getElementById('card');

    function parse(text) {
        return text.split('\n')
            .filter(line => line.trim())
            .map(line => {
                let parts = line.includes(',') ? line.split(',') : line.split('\t');
                return { front: parts[0]?.trim(), back: parts[1]?.trim() };
            })
            .filter(c => c.front && c.back);
    }

    function loadVocab() {
        let txt = document.getElementById("input").value;
        cards = parse(txt);
        if(cards.length === 0) return alert("Add some words first, bro!");
        localStorage.setItem("vocabCards", JSON.stringify(cards));
        start();
    }

    function loadSaved() {
        let saved = localStorage.getItem("vocabCards");
        if(!saved) return alert("Nothing saved yet!");
        cards = JSON.parse(saved);
        start();
    }

    function start() {
        document.getElementById("setup").classList.add("hidden");
        document.getElementById("game").classList.remove("hidden");
        index = 0; correct = []; wrong = [];
        showCard();
    }

    function showCard() {
        if (index >= cards.length) return finish();
        
        const c = cards[index];
        const progress = (index / cards.length) * 100;
        document.getElementById("progress-bar").style.width = `${progress}%`;
        
        // Reset card state
        cardEl.style.transform = 'none';
        cardEl.classList.remove('flipped', 'flipping');
        document.getElementById("front").textContent = c.front;
        document.getElementById("back").textContent = c.back;
    }

    // Interaction Logic
    cardEl.addEventListener('pointerdown', e => {
        startX = e.clientX;
        isDragging = true;
    });

    window.addEventListener('pointermove', e => {
        if (!isDragging || cardEl.classList.contains('flipping')) return;
        currentX = e.clientX - startX;
        let rotate = currentX / 10;
        cardEl.style.transform = `translateX(${currentX}px) rotate(${rotate}deg)`;
        
        // Change colors based on swipe direction
        if (currentX > 50) cardEl.querySelector('.front').style.background = '#e8f5e9';
        else if (currentX < -50) cardEl.querySelector('.front').style.background = '#ffebee';
        else cardEl.querySelector('.front').style.background = 'white';
    });

    window.addEventListener('pointerup', e => {
        if (!isDragging) return;
        isDragging = false;
        
        if (Math.abs(currentX) > 120) {
            // Swipe threshold met
            mark(currentX > 0);
        } else {
            // Reset position if tap or small movement
            if (Math.abs(currentX) < 5) {
                cardEl.classList.add('flipping');
                cardEl.classList.toggle('flipped');
            } else {
                cardEl.style.transform = 'translateX(0) rotate(0)';
                cardEl.querySelector('.front').style.background = 'white';
            }
        }
        currentX = 0;
    });

    function mark(knew) {
        let c = cards[index];
        if (knew) correct.push(c); else wrong.push(c);
        
        // Fly away animation
        const direction = knew ? 1000 : -1000;
        cardEl.style.transition = 'transform 0.4s ease-in';
        cardEl.style.transform = `translateX(${direction}px) rotate(${direction/10}deg)`;
        
        setTimeout(() => {
            cardEl.style.transition = 'none';
            index++;
            showCard();
        }, 300);
    }

    function manualMark(knew) {
        if (isDragging) return;
        mark(knew);
    }

    function finish() {
        document.getElementById("game").classList.add("hidden");
        document.getElementById("result").classList.remove("hidden");
        document.getElementById("score-text").innerHTML = `Done! üéØ<br><span style="font-size:18px">${correct.length} correct ‚Ä¢ ${wrong.length} missed</span>`;
        
        let html = "";
        if(wrong.length > 0) {
            html += `<h4 style="color:var(--error)">To Review:</h4>`;
            wrong.forEach(c => html += `<div style="margin-bottom:5px; font-size:14px">‚ùå ${c.front} ‚Üí ${c.back}</div>`);
        }
        if(correct.length > 0) {
            html += `<h4 style="color:var(--success); margin-top:20px">Mastered:</h4>`;
            correct.forEach(c => html += `<div style="margin-bottom:5px; font-size:14px; opacity:0.7">‚úÖ ${c.front}</div>`);
        }
        document.getElementById("result-lists").innerHTML = html;
    }
</script>

</body>
</html>
